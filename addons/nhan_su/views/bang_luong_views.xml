<?xml version="1.0" encoding="utf-8"?>
<odoo>
    
    <!-- Tree View - Bảng lương -->
    <record id="view_bang_luong_tree" model="ir.ui.view">
        <field name="name">bang_luong.tree</field>
        <field name="model">bang_luong</field>
        <field name="arch" type="xml">
            <tree string="Bảng lương" decoration-info="trang_thai == 'nhap'"
                                       decoration-warning="trang_thai == 'cho_duyet'"
                                       decoration-success="trang_thai == 'da_duyet'"
                                       decoration-muted="trang_thai == 'da_chi_tra'">
                <field name="nhan_vien_id"/>
                <field name="phong_ban_id"/>
                <field name="chuc_vu_id"/>
                <field name="thang"/>
                <field name="nam"/>
                <field name="so_ngay_cong"/>
                <field name="luong_co_ban" sum="Tổng lương cơ bản"/>
                <field name="tong_thu_nhap" sum="Tổng thu nhập"/>
                <field name="tong_khau_tru" sum="Tổng khấu trừ"/>
                <field name="thuc_linh" sum="Tổng thực lĩnh"/>
                <field name="trang_thai"/>
            </tree>
        </field>
    </record>

    <!-- Form View - Bảng lương -->
    <record id="view_bang_luong_form" model="ir.ui.view">
        <field name="name">bang_luong.form</field>
        <field name="model">bang_luong</field>
        <field name="arch" type="xml">
            <form string="Bảng lương">
                <header>
                    <button name="action_gui_duyet" string="Gửi duyệt" type="object" 
                            class="oe_highlight" attrs="{'invisible': [('trang_thai', '!=', 'nhap')]}"/>
                    <button name="action_duyet" string="Duyệt" type="object" 
                            class="oe_highlight" attrs="{'invisible': [('trang_thai', '!=', 'cho_duyet')]}"/>
                    <button name="action_chi_tra" string="Đã chi trả" type="object" 
                            class="oe_highlight" attrs="{'invisible': [('trang_thai', '!=', 'da_duyet')]}"/>
                    <button name="action_huy_duyet" string="Hủy duyệt" type="object" 
                            attrs="{'invisible': [('trang_thai', 'in', ['nhap', 'da_chi_tra'])]}"/>
                    <field name="trang_thai" widget="statusbar" statusbar_visible="nhap,cho_duyet,da_duyet,da_chi_tra"/>
                </header>
                <sheet>
                    <group>
                        <group string="Thông tin nhân viên">
                            <field name="nhan_vien_id"/>
                            <field name="phong_ban_id"/>
                            <field name="chuc_vu_id"/>
                        </group>
                        <group string="Kỳ lương">
                            <field name="thang"/>
                            <field name="nam"/>
                            <field name="ngay_cham"/>
                        </group>
                    </group>
                    
                    <group string="Thông tin công">
                        <group>
                            <field name="so_ngay_cong"/>
                            <field name="so_gio_tang_ca"/>
                        </group>
                        <group>
                            <field name="ngay_nghi_co_phep"/>
                            <field name="ngay_nghi_khong_phep"/>
                        </group>
                    </group>
                    
                    <notebook>
                        <page string="Lương và phụ cấp">
                            <group>
                                <group string="Lương cơ bản">
                                    <field name="luong_co_ban"/>
                                </group>
                            </group>
                            <group string="Phụ cấp">
                                <group>
                                    <field name="phu_cap_chuc_vu"/>
                                    <field name="phu_cap_an_trua"/>
                                    <field name="phu_cap_xang_xe"/>
                                </group>
                                <group>
                                    <field name="phu_cap_dien_thoai"/>
                                    <field name="phu_cap_khac"/>
                                </group>
                            </group>
                        </page>
                        
                        <page string="Tăng ca và thưởng">
                            <group>
                                <group>
                                    <field name="tien_tang_ca"/>
                                </group>
                                <group>
                                    <field name="tien_thuong"/>
                                </group>
                            </group>
                        </page>
                        
                        <page string="Khấu trừ">
                            <group string="Bảo hiểm">
                                <group>
                                    <field name="khau_tru_bhxh"/>
                                    <field name="khau_tru_bhyt"/>
                                </group>
                                <group>
                                    <field name="khau_tru_bhtn"/>
                                </group>
                            </group>
                            <group string="Thuế và khấu trừ khác">
                                <group>
                                    <field name="khau_tru_thue"/>
                                </group>
                                <group>
                                    <field name="khau_tru_khac"/>
                                </group>
                            </group>
                        </page>
                        
                        <page string="Tổng hợp">
                            <group>
                                <group>
                                    <field name="tong_thu_nhap" style="font-weight: bold; font-size: 1.1em;"/>
                                    <field name="tong_khau_tru" style="font-weight: bold; font-size: 1.1em;"/>
                                </group>
                                <group>
                                    <field name="thuc_linh" style="font-weight: bold; font-size: 1.3em; color: #00875A;"/>
                                </group>
                            </group>
                        </page>
                    </notebook>
                    
                    <group string="Ghi chú">
                        <field name="ghi_chu" nolabel="1"/>
                    </group>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" widget="mail_followers"/>
                    <field name="message_ids" widget="mail_thread"/>
                </div>
            </form>
        </field>
    </record>

    <!-- Search View - Bảng lương -->
    <record id="view_bang_luong_search" model="ir.ui.view">
        <field name="name">bang_luong.search</field>
        <field name="model">bang_luong</field>
        <field name="arch" type="xml">
            <search string="Tìm kiếm bảng lương">
                <field name="nhan_vien_id"/>
                <field name="phong_ban_id"/>
                <field name="chuc_vu_id"/>
                <field name="thang"/>
                <field name="nam"/>
                <separator/>
                <filter string="Đang nhập" name="nhap" domain="[('trang_thai', '=', 'nhap')]"/>
                <filter string="Chờ duyệt" name="cho_duyet" domain="[('trang_thai', '=', 'cho_duyet')]"/>
                <filter string="Đã duyệt" name="da_duyet" domain="[('trang_thai', '=', 'da_duyet')]"/>
                <filter string="Đã chi trả" name="da_chi_tra" domain="[('trang_thai', '=', 'da_chi_tra')]"/>
                <separator/>
                <filter string="Tháng này" name="this_month" 
                        domain="[('thang', '=', context_today().month), ('nam', '=', context_today().year)]"/>
                <group expand="0" string="Nhóm theo">
                    <filter string="Nhân viên" name="group_nhan_vien" context="{'group_by':'nhan_vien_id'}"/>
                    <filter string="Phòng ban" name="group_phong_ban" context="{'group_by':'phong_ban_id'}"/>
                    <filter string="Chức vụ" name="group_chuc_vu" context="{'group_by':'chuc_vu_id'}"/>
                    <filter string="Tháng" name="group_thang" context="{'group_by':'thang'}"/>
                    <filter string="Năm" name="group_nam" context="{'group_by':'nam'}"/>
                    <filter string="Trạng thái" name="group_trang_thai" context="{'group_by':'trang_thai'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- Action - Bảng lương -->
    <record id="action_bang_luong" model="ir.actions.act_window">
        <field name="name">Bảng lương</field>
        <field name="res_model">bang_luong</field>
        <field name="view_mode">tree,form</field>
        <field name="context">{'search_default_this_month': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Tạo bảng lương mới
            </p>
            <p>
                Quản lý bảng lương hàng tháng cho nhân viên với đầy đủ các khoản thu nhập và khấu trừ.
            </p>
        </field>
    </record>

</odoo>
